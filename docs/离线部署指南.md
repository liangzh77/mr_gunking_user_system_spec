# ç¦»çº¿éƒ¨ç½²æŒ‡å— (é˜¿é‡Œäº‘/ç½‘ç»œå—é™ç¯å¢ƒ)

**ç‰ˆæœ¬**: v1.0.0-mvp
**æ›´æ–°æ—¥æœŸ**: 2025-10-28
**é€‚ç”¨åœºæ™¯**: é˜¿é‡Œäº‘ECSã€å†…ç½‘æœåŠ¡å™¨ç­‰æ— æ³•è®¿é—®Docker Hubçš„ç¯å¢ƒ

---

## ğŸ“‹ ç›®å½•

1. [åœºæ™¯è¯´æ˜](#åœºæ™¯è¯´æ˜)
2. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
3. [é•œåƒå‡†å¤‡](#é•œåƒå‡†å¤‡)
4. [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
5. [éªŒè¯éƒ¨ç½²](#éªŒè¯éƒ¨ç½²)
6. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## åœºæ™¯è¯´æ˜

### é€‚ç”¨åœºæ™¯

å¦‚æœä½ çš„ç”Ÿäº§æœåŠ¡å™¨é‡åˆ°ä»¥ä¸‹æƒ…å†µ:

- âœ… é˜¿é‡Œäº‘ECSæ— æ³•è®¿é—®Docker Hub
- âœ… å†…ç½‘ç¯å¢ƒæ— æ³•è¿æ¥å¤–ç½‘
- âœ… `docker pull` å‘½ä»¤å¤±è´¥æˆ–ææ…¢
- âœ… `docker-compose build` ä¸‹è½½é•œåƒè¶…æ—¶

æœ¬æŒ‡å—æä¾›**å®Œå…¨ç¦»çº¿éƒ¨ç½²æ–¹æ¡ˆ**ã€‚

### éƒ¨ç½²æµç¨‹æ¦‚è§ˆ

```
æœ¬åœ°æœºå™¨                   ç”Ÿäº§æœåŠ¡å™¨
  |                            |
  | 1. ä¸‹è½½Dockeré•œåƒ          |
  | 2. å¯¼å‡ºä¸ºtaræ–‡ä»¶           |
  |                            |
  |----  ä¸Šä¼ taræ–‡ä»¶  -------->|
                               |
                               | 3. åŠ è½½é•œåƒ
                               | 4. å…‹éš†ä»£ç 
                               | 5. æ„å»ºåº”ç”¨
                               | 6. å¯åŠ¨æœåŠ¡
                               |
```

---

## å‡†å¤‡å·¥ä½œ

### æœ¬åœ°ç¯å¢ƒè¦æ±‚

- Dockerå·²å®‰è£…
- èƒ½å¤Ÿè®¿é—®Docker Hub
- è‡³å°‘500MBç£ç›˜ç©ºé—´

### ç”Ÿäº§æœåŠ¡å™¨è¦æ±‚

- Linuxç³»ç»Ÿ (Ubuntu 20.04+, CentOS 7+)
- Dockerå·²å®‰è£…
- Docker Composeå·²å®‰è£…
- è‡³å°‘10GBç£ç›˜ç©ºé—´

---

## é•œåƒå‡†å¤‡

### æ­¥éª¤1: åœ¨æœ¬åœ°ä¸‹è½½é•œåƒ

åœ¨**æœ¬åœ°æœºå™¨**(èƒ½è®¿é—®Docker Hub)ä¸Šæ‰§è¡Œ:

```bash
# åˆ›å»ºé•œåƒç›®å½•
mkdir -p ~/docker-images
cd ~/docker-images

# ä¸‹è½½æ‰€æœ‰å¿…éœ€çš„åŸºç¡€é•œåƒ
echo "ä¸‹è½½ PostgreSQL..."
docker pull postgres:14-alpine

echo "ä¸‹è½½ Redis..."
docker pull redis:7-alpine

echo "ä¸‹è½½ Python..."
docker pull python:3.12-slim

echo "ä¸‹è½½ Node.js..."
docker pull node:18-alpine

echo "ä¸‹è½½ Nginx..."
docker pull nginx:alpine

# éªŒè¯ä¸‹è½½
docker images | grep -E "postgres|redis|python|node|nginx"
```

### æ­¥éª¤2: å¯¼å‡ºé•œåƒä¸ºtaræ–‡ä»¶

```bash
cd ~/docker-images

echo "å¯¼å‡ºé•œåƒ..."

docker save postgres:14-alpine -o postgres-14-alpine.tar
docker save redis:7-alpine -o redis-7-alpine.tar
docker save python:3.12-slim -o python-3.12-slim.tar
docker save node:18-alpine -o node-18-alpine.tar
docker save nginx:alpine -o nginx-alpine.tar

# æŸ¥çœ‹å¯¼å‡ºçš„æ–‡ä»¶
ls -lh

# é¢„æœŸè¾“å‡º:
# -rw-r--r-- 1 user user 104M Oct 28 15:10 postgres-14-alpine.tar
# -rw-r--r-- 1 user user  17M Oct 28 15:10 redis-7-alpine.tar
# -rw-r--r-- 1 user user  44M Oct 28 15:10 python-3.12-slim.tar
# -rw-r--r-- 1 user user  43M Oct 28 15:10 node-18-alpine.tar
# -rw-r--r-- 1 user user  22M Oct 28 15:10 nginx-alpine.tar
```

### æ­¥éª¤3: ä¸Šä¼ åˆ°ç”Ÿäº§æœåŠ¡å™¨

é€‰æ‹©ä¸€ç§æ–¹å¼ä¸Šä¼ :

**æ–¹å¼1: ä½¿ç”¨scp (Linux/Mac)**

```bash
cd ~/docker-images

# ä¸Šä¼ åˆ°ç”Ÿäº§æœåŠ¡å™¨
scp *.tar root@your-server-ip:/root/docker-images/

# æˆ–è€…æ‰“åŒ…åä¸Šä¼ (å‡å°‘ä¼ è¾“æ¬¡æ•°)
tar czf docker-images.tar.gz *.tar
scp docker-images.tar.gz root@your-server-ip:/root/

# åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
# ssh root@your-server-ip
# mkdir -p /root/docker-images
# tar xzf docker-images.tar.gz -C /root/docker-images/
```

**æ–¹å¼2: ä½¿ç”¨WinSCP/FileZilla (Windows)**

1. æ‰“å¼€WinSCPæˆ–FileZilla
2. è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨
3. åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•: `/root/docker-images/`
4. ä¸Šä¼ æ‰€æœ‰ `.tar` æ–‡ä»¶åˆ°è¯¥ç›®å½•

**æ–¹å¼3: ä½¿ç”¨äº‘æœåŠ¡å•†OSS**

```bash
# ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS
aliyun oss cp *.tar oss://your-bucket/docker-images/

# åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸‹è½½
aliyun oss cp oss://your-bucket/docker-images/ /root/docker-images/ --recursive
```

---

## éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: éªŒè¯é•œåƒæ–‡ä»¶

åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Š:

```bash
# æŸ¥çœ‹é•œåƒæ–‡ä»¶
ls -lh /root/docker-images/

# é¢„æœŸè¾“å‡º (5ä¸ªæ–‡ä»¶):
# -rw-r--r-- 1 root root 104M Oct 28 15:10 postgres-14-alpine.tar
# -rw-r--r-- 1 root root  17M Oct 28 15:10 redis-7-alpine.tar
# -rw-r--r-- 1 root root  44M Oct 28 15:10 python-3.12-slim.tar
# -rw-r--r-- 1 root root  43M Oct 28 15:10 node-18-alpine.tar
# -rw-r--r-- 1 root root  22M Oct 28 15:10 nginx-alpine.tar
```

### æ­¥éª¤2: å…‹éš†ä»£ç 

```bash
cd /opt

# å…‹éš†ä»£ç  (å¦‚æœGitä¹Ÿæ— æ³•è®¿é—®,éœ€è¦æ‰‹åŠ¨ä¸Šä¼ ä»£ç åŒ…)
git clone https://github.com/liangzh77/mr_gunking_user_system_spec.git

cd mr_gunking_user_system_spec

# åˆ‡æ¢åˆ°MVPç‰ˆæœ¬
git checkout v1.0.0-mvp
```

### æ­¥éª¤3: åˆ›å»ºç¦»çº¿éƒ¨ç½²è„šæœ¬

```bash
cd /opt/mr_gunking_user_system_spec

# åˆ›å»ºéƒ¨ç½²è„šæœ¬
cat > deploy_offline.sh << 'DEPLOY_EOF'
#!/bin/bash
set -e

# é¢œè‰²å®šä¹‰
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

echo -e "${BLUE}=========================================="
echo -e "  MRæ¸¸æˆè¿è¥ç®¡ç†ç³»ç»Ÿ - ç¦»çº¿éƒ¨ç½²"
echo -e "==========================================${NC}"
echo ""

# ============================================================================
# æ­¥éª¤1: åŠ è½½Dockeré•œåƒ
# ============================================================================
echo -e "${YELLOW}[1/6] åŠ è½½Dockeré•œåƒ...${NC}"
IMAGES_DIR="/root/docker-images"

if [ ! -d "$IMAGES_DIR" ]; then
    echo -e "${RED}é”™è¯¯: é•œåƒç›®å½• $IMAGES_DIR ä¸å­˜åœ¨${NC}"
    exit 1
fi

# å¿…éœ€çš„é•œåƒæ–‡ä»¶
REQUIRED_IMAGES=(
    "postgres-14-alpine.tar"
    "redis-7-alpine.tar"
    "python-3.12-slim.tar"
    "node-18-alpine.tar"
    "nginx-alpine.tar"
)

LOADED=0
FAILED=0

for img in "${REQUIRED_IMAGES[@]}"; do
    IMG_PATH="$IMAGES_DIR/$img"
    if [ -f "$IMG_PATH" ]; then
        echo -n "  åŠ è½½: $img ... "
        if docker load -i "$IMG_PATH" > /dev/null 2>&1; then
            echo -e "${GREEN}âœ“${NC}"
            LOADED=$((LOADED + 1))
        else
            echo -e "${RED}âœ—${NC}"
            FAILED=$((FAILED + 1))
        fi
    else
        echo -e "  ${RED}âœ— æ–‡ä»¶ä¸å­˜åœ¨: $img${NC}"
        FAILED=$((FAILED + 1))
    fi
done

if [ $FAILED -gt 0 ]; then
    echo -e "${RED}é”™è¯¯: æœ‰ $FAILED ä¸ªé•œåƒåŠ è½½å¤±è´¥${NC}"
    exit 1
fi

echo -e "${GREEN}âœ“ æˆåŠŸåŠ è½½ $LOADED/${#REQUIRED_IMAGES[@]} ä¸ªé•œåƒ${NC}"
echo ""

# æ˜¾ç¤ºå·²åŠ è½½çš„é•œåƒ
echo "å·²åŠ è½½çš„é•œåƒ:"
docker images --format "table {{.Repository}}\t{{.Tag}}\t{{.Size}}" | grep -E "postgres|redis|python|node|nginx|REPOSITORY"
echo ""

# ============================================================================
# æ­¥éª¤2: æ£€æŸ¥é¡¹ç›®ç›®å½•
# ============================================================================
echo -e "${YELLOW}[2/6] æ£€æŸ¥é¡¹ç›®ç¯å¢ƒ...${NC}"

if [ ! -f "docker-compose.prod.yml" ]; then
    echo -e "${RED}é”™è¯¯: æœªæ‰¾åˆ° docker-compose.prod.yml${NC}"
    echo "è¯·ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½• /opt/mr_gunking_user_system_spec æ‰§è¡Œæ­¤è„šæœ¬"
    exit 1
fi

echo -e "${GREEN}âœ“ é¡¹ç›®ç›®å½•æ­£ç¡®${NC}"
echo ""

# ============================================================================
# æ­¥éª¤3: é…ç½®ç¯å¢ƒå˜é‡
# ============================================================================
echo -e "${YELLOW}[3/6] é…ç½®ç¯å¢ƒå˜é‡...${NC}"

if [ ! -f ".env.production" ]; then
    echo -e "${YELLOW}æœªæ‰¾åˆ° .env.production é…ç½®æ–‡ä»¶${NC}"

    if [ -f "configure_env.sh" ]; then
        echo "å‘ç°è‡ªåŠ¨é…ç½®è„šæœ¬"
        read -p "æ˜¯å¦è¿è¡Œè‡ªåŠ¨é…ç½®? (y/n): " run_config
        if [ "$run_config" = "y" ]; then
            ./configure_env.sh
        else
            echo ""
            echo "è¯·æ‰‹åŠ¨é…ç½®:"
            echo "  1. cp .env.production.template .env.production"
            echo "  2. nano .env.production"
            echo "  3. ä¿®æ”¹å¿…è¦çš„é…ç½®é¡¹"
            exit 1
        fi
    else
        echo -e "${RED}è¯·å…ˆåˆ›å»ºé…ç½®æ–‡ä»¶${NC}"
        echo "  1. cp .env.production.template .env.production"
        echo "  2. nano .env.production"
        exit 1
    fi
fi

echo -e "${GREEN}âœ“ é…ç½®æ–‡ä»¶å·²å°±ç»ª${NC}"
echo ""

# ============================================================================
# æ­¥éª¤4: åœæ­¢æ—§æœåŠ¡
# ============================================================================
echo -e "${YELLOW}[4/6] æ£€æŸ¥å¹¶åœæ­¢æ—§æœåŠ¡...${NC}"

if docker-compose -f docker-compose.prod.yml ps -q 2>/dev/null | grep -q .; then
    echo "å‘ç°è¿è¡Œä¸­çš„æœåŠ¡,æ­£åœ¨åœæ­¢..."
    docker-compose -f docker-compose.prod.yml down
    echo -e "${GREEN}âœ“ æ—§æœåŠ¡å·²åœæ­¢${NC}"
else
    echo "æ²¡æœ‰è¿è¡Œä¸­çš„æœåŠ¡"
fi
echo ""

# ============================================================================
# æ­¥éª¤5: æ„å»ºåº”ç”¨é•œåƒ
# ============================================================================
echo -e "${YELLOW}[5/6] æ„å»ºåº”ç”¨é•œåƒ...${NC}"
echo "è¿™å¯èƒ½éœ€è¦5-10åˆ†é’Ÿ,è¯·è€å¿ƒç­‰å¾…..."
echo ""

# è®¾ç½®æ„å»ºå‚æ•°
export BUILD_DATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ')
export VERSION="1.0.0"

# æ„å»ºåç«¯
echo -e "${BLUE}æ„å»ºåç«¯æœåŠ¡...${NC}"
if docker-compose -f docker-compose.prod.yml build backend; then
    echo -e "${GREEN}âœ“ åç«¯æ„å»ºæˆåŠŸ${NC}"
else
    echo -e "${RED}âœ— åç«¯æ„å»ºå¤±è´¥${NC}"
    echo "è¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¹¶ä¿®å¤"
    exit 1
fi
echo ""

# æ„å»ºå‰ç«¯
echo -e "${BLUE}æ„å»ºå‰ç«¯æœåŠ¡...${NC}"
if docker-compose -f docker-compose.prod.yml build frontend; then
    echo -e "${GREEN}âœ“ å‰ç«¯æ„å»ºæˆåŠŸ${NC}"
else
    echo -e "${RED}âœ— å‰ç«¯æ„å»ºå¤±è´¥${NC}"
    echo "è¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¹¶ä¿®å¤"
    exit 1
fi
echo ""

# ============================================================================
# æ­¥éª¤6: å¯åŠ¨æ‰€æœ‰æœåŠ¡
# ============================================================================
echo -e "${YELLOW}[6/6] å¯åŠ¨æœåŠ¡...${NC}"

if docker-compose -f docker-compose.prod.yml up -d; then
    echo -e "${GREEN}âœ“ æœåŠ¡å¯åŠ¨æˆåŠŸ${NC}"
else
    echo -e "${RED}âœ— æœåŠ¡å¯åŠ¨å¤±è´¥${NC}"
    echo "æŸ¥çœ‹æ—¥å¿—: docker-compose -f docker-compose.prod.yml logs"
    exit 1
fi
echo ""

# ç­‰å¾…æœåŠ¡å°±ç»ª
echo -e "${YELLOW}ç­‰å¾…æœåŠ¡å¯åŠ¨(30ç§’)...${NC}"
for i in {30..1}; do
    echo -ne "\rå‰©ä½™: $i ç§’  "
    sleep 1
done
echo ""
echo ""

# ============================================================================
# æ˜¾ç¤ºéƒ¨ç½²ç»“æœ
# ============================================================================
echo -e "${BLUE}=========================================="
echo -e "  éƒ¨ç½²å®Œæˆ!"
echo -e "==========================================${NC}"
echo ""

# è·å–æœåŠ¡å™¨IP
SERVER_IP=$(hostname -I | awk '{print $1}')

# æ˜¾ç¤ºæœåŠ¡çŠ¶æ€
echo -e "${YELLOW}æœåŠ¡çŠ¶æ€:${NC}"
docker-compose -f docker-compose.prod.yml ps
echo ""

# æ˜¾ç¤ºè®¿é—®ä¿¡æ¯
echo -e "${GREEN}=========================================="
echo -e "  è®¿é—®ä¿¡æ¯"
echo -e "==========================================${NC}"
echo ""
echo "å‰ç«¯åœ°å€:   http://$SERVER_IP"
echo "åç«¯API:    http://$SERVER_IP:8000"
echo "å¥åº·æ£€æŸ¥:   http://$SERVER_IP:8000/health"
echo "APIæ–‡æ¡£:    http://$SERVER_IP:8000/docs"
echo ""

# æµ‹è¯•å¥åº·æ£€æŸ¥
echo -e "${YELLOW}æµ‹è¯•æœåŠ¡å¥åº·çŠ¶æ€...${NC}"
sleep 5

if curl -s -f http://localhost:8000/health > /dev/null 2>&1; then
    HEALTH_STATUS=$(curl -s http://localhost:8000/health)
    echo -e "${GREEN}âœ“ åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸${NC}"
    echo "  $HEALTH_STATUS"
else
    echo -e "${RED}âœ— åç«¯æœåŠ¡å¯èƒ½æœªå°±ç»ª${NC}"
    echo "  è¯·ç¨åè®¿é—®æˆ–æŸ¥çœ‹æ—¥å¿—"
fi
echo ""

# æ˜¾ç¤ºç®¡ç†å‘½ä»¤
echo -e "${GREEN}=========================================="
echo -e "  å¸¸ç”¨ç®¡ç†å‘½ä»¤"
echo -e "==========================================${NC}"
echo ""
echo "æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—:"
echo "  docker-compose -f docker-compose.prod.yml logs -f"
echo ""
echo "æŸ¥çœ‹åç«¯æ—¥å¿—:"
echo "  docker-compose -f docker-compose.prod.yml logs -f backend"
echo ""
echo "æŸ¥çœ‹å‰ç«¯æ—¥å¿—:"
echo "  docker-compose -f docker-compose.prod.yml logs -f frontend"
echo ""
echo "é‡å¯æœåŠ¡:"
echo "  docker-compose -f docker-compose.prod.yml restart"
echo ""
echo "åœæ­¢æœåŠ¡:"
echo "  docker-compose -f docker-compose.prod.yml down"
echo ""
echo "æŸ¥çœ‹å®¹å™¨çŠ¶æ€:"
echo "  docker-compose -f docker-compose.prod.yml ps"
echo ""

# ä¿å­˜éƒ¨ç½²ä¿¡æ¯
DEPLOY_INFO="DEPLOY_INFO.txt"
cat > "$DEPLOY_INFO" << INFO_EOF
========================================
  MRæ¸¸æˆè¿è¥ç®¡ç†ç³»ç»Ÿ - éƒ¨ç½²ä¿¡æ¯
========================================
éƒ¨ç½²æ—¶é—´: $(date)
éƒ¨ç½²æ–¹å¼: ç¦»çº¿éƒ¨ç½²
æœåŠ¡å™¨IP: $SERVER_IP
ç‰ˆæœ¬: $VERSION

è®¿é—®åœ°å€:
  å‰ç«¯:     http://$SERVER_IP
  åç«¯API:  http://$SERVER_IP:8000
  å¥åº·æ£€æŸ¥: http://$SERVER_IP:8000/health
  APIæ–‡æ¡£:  http://$SERVER_IP:8000/docs

æœåŠ¡åˆ—è¡¨:
$(docker-compose -f docker-compose.prod.yml ps)

ç®¡ç†å‘½ä»¤:
  æŸ¥çœ‹æ—¥å¿—: docker-compose -f docker-compose.prod.yml logs -f
  é‡å¯æœåŠ¡: docker-compose -f docker-compose.prod.yml restart
  åœæ­¢æœåŠ¡: docker-compose -f docker-compose.prod.yml down
  æœåŠ¡çŠ¶æ€: docker-compose -f docker-compose.prod.yml ps

é…ç½®æ–‡ä»¶:
  ç¯å¢ƒé…ç½®: .env.production
  Dockeré…ç½®: docker-compose.prod.yml

æ•°æ®å¤‡ä»½:
  æ•°æ®åº“å¤‡ä»½: docker exec mr_game_ops_db_prod pg_dump -U mr_admin mr_game_ops > backup.sql

========================================
INFO_EOF

echo -e "${GREEN}éƒ¨ç½²ä¿¡æ¯å·²ä¿å­˜åˆ°: $DEPLOY_INFO${NC}"
echo ""

DEPLOY_EOF

# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy_offline.sh

echo "ç¦»çº¿éƒ¨ç½²è„šæœ¬å·²åˆ›å»º: deploy_offline.sh"
```

### æ­¥éª¤4: è¿è¡Œéƒ¨ç½²è„šæœ¬

```bash
cd /opt/mr_gunking_user_system_spec

# æ‰§è¡Œéƒ¨ç½²
./deploy_offline.sh
```

éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ:
1. åŠ è½½Dockeré•œåƒ
2. æ£€æŸ¥é¡¹ç›®ç¯å¢ƒ
3. é…ç½®ç¯å¢ƒå˜é‡
4. åœæ­¢æ—§æœåŠ¡
5. æ„å»ºåº”ç”¨é•œåƒ
6. å¯åŠ¨æ‰€æœ‰æœåŠ¡

---

## éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€

```bash
cd /opt/mr_gunking_user_system_spec
docker-compose -f docker-compose.prod.yml ps
```

é¢„æœŸè¾“å‡º (æ‰€æœ‰æœåŠ¡åº”ä¸º "Up" çŠ¶æ€):
```
NAME                            STATUS         PORTS
mr_game_ops_backend_prod       Up (healthy)   0.0.0.0:8000->8000/tcp
mr_game_ops_db_prod            Up (healthy)   5432/tcp
mr_game_ops_frontend_prod      Up             0.0.0.0:80->80/tcp
mr_game_ops_redis_prod         Up (healthy)   6379/tcp
```

### 2. æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/health
```

é¢„æœŸè¾“å‡º:
```json
{"status":"healthy","version":"1.0.0","environment":"production"}
```

### 3. è®¿é—®å‰ç«¯

åœ¨æµè§ˆå™¨ä¸­è®¿é—®: `http://ä½ çš„æœåŠ¡å™¨IP`

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# åªçœ‹åç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f backend

# åªçœ‹å‰ç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f frontend

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
docker-compose -f docker-compose.prod.yml logs --tail=100
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: é•œåƒåŠ è½½å¤±è´¥

**ç—‡çŠ¶**: `docker load -i xxx.tar` æŠ¥é”™

**è§£å†³**:
```bash
# æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
md5sum /root/docker-images/*.tar

# é‡æ–°ä¸‹è½½å¹¶ä¸Šä¼ è¯¥é•œåƒ
# æˆ–ä½¿ç”¨ docker pull ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‹‰å–
```

### é—®é¢˜2: æ„å»ºå¤±è´¥ - æ— æ³•ä¸‹è½½ä¾èµ–

**ç—‡çŠ¶**: æ„å»ºæ—¶æç¤º `pip install` æˆ– `npm install` å¤±è´¥

**è§£å†³**:

åç«¯Pythonä¾èµ–:
```bash
# æ–¹æ¡ˆ1: é…ç½®å›½å†…é•œåƒæº
export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
docker-compose -f docker-compose.prod.yml build backend

# æ–¹æ¡ˆ2: å‡†å¤‡ç¦»çº¿ä¾èµ–åŒ…
# åœ¨æœ¬åœ°ä¸‹è½½ä¾èµ–:
pip download -r backend/requirements.txt -d /tmp/pip-deps
# ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶åœ¨Dockerfileä¸­ä½¿ç”¨
```

å‰ç«¯npmä¾èµ–:
```bash
# é…ç½®å›½å†…é•œåƒæº
export NPM_CONFIG_REGISTRY=https://registry.npmmirror.com
docker-compose -f docker-compose.prod.yml build frontend
```

### é—®é¢˜3: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**æ£€æŸ¥æ—¥å¿—**:
```bash
docker-compose -f docker-compose.prod.yml logs backend
docker-compose -f docker-compose.prod.yml logs postgres
```

**å¸¸è§åŸå› **:
1. æ•°æ®åº“å¯†ç é…ç½®ä¸ä¸€è‡´
2. ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯
3. ç«¯å£è¢«å ç”¨

### é—®é¢˜4: å‰ç«¯æ— æ³•è¿æ¥åç«¯

**æ£€æŸ¥é…ç½®**:
```bash
# æŸ¥çœ‹å‰ç«¯é…ç½®
grep VITE_API_BASE_URL .env.production

# åº”è¯¥ç±»ä¼¼: VITE_API_BASE_URL=http://ä½ çš„æœåŠ¡å™¨IP/api/v1
```

**é‡æ–°æ„å»ºå‰ç«¯**:
```bash
docker-compose -f docker-compose.prod.yml build frontend
docker-compose -f docker-compose.prod.yml up -d frontend
```

### é—®é¢˜5: æ•°æ®åº“è¿æ¥å¤±è´¥

**æ£€æŸ¥æ•°æ®åº“çŠ¶æ€**:
```bash
docker exec -it mr_game_ops_db_prod psql -U mr_admin -d mr_game_ops

# å¦‚æœèƒ½è¿›å…¥,è¯´æ˜æ•°æ®åº“æ­£å¸¸
# ç„¶åæ£€æŸ¥åç«¯é…ç½®ä¸­çš„DATABASE_URLæ˜¯å¦æ­£ç¡®
```

---

## é•œåƒæ¸…å•

### å¿…éœ€é•œåƒ (5ä¸ª, ~230MB)

| é•œåƒ | å¤§å° | ç”¨é€” | Docker Tag |
|------|------|------|------------|
| postgres-14-alpine.tar | ~104MB | PostgreSQLæ•°æ®åº“ | postgres:14-alpine |
| redis-7-alpine.tar | ~17MB | Redisç¼“å­˜ | redis:7-alpine |
| python-3.12-slim.tar | ~44MB | Pythonè¿è¡Œç¯å¢ƒ(åç«¯) | python:3.12-slim |
| node-18-alpine.tar | ~43MB | Node.jsç¯å¢ƒ(å‰ç«¯æ„å»º) | node:18-alpine |
| nginx-alpine.tar | ~22MB | NginxæœåŠ¡å™¨(å‰ç«¯) | nginx:alpine |

### å¯é€‰é•œåƒ (ç›‘æ§ç›¸å…³,å¯æš‚æ—¶ä¸ç”¨)

| é•œåƒ | å¤§å° | ç”¨é€” |
|------|------|------|
| grafana-latest.tar | ~195MB | ç›‘æ§é¢æ¿ |
| prometheus-latest.tar | ~129MB | ç›‘æ§ç³»ç»Ÿ |

---

## é™„å½•

### A. å®Œæ•´éƒ¨ç½²æ—¶é—´çº¿

| æ­¥éª¤ | é¢„è®¡è€—æ—¶ | è¯´æ˜ |
|------|---------|------|
| ä¸‹è½½é•œåƒ(æœ¬åœ°) | 5-10åˆ†é’Ÿ | å–å†³äºç½‘ç»œé€Ÿåº¦ |
| å¯¼å‡ºé•œåƒ | 2-3åˆ†é’Ÿ | |
| ä¸Šä¼ åˆ°æœåŠ¡å™¨ | 5-15åˆ†é’Ÿ | å–å†³äºå¸¦å®½ |
| åŠ è½½é•œåƒ | 1-2åˆ†é’Ÿ | |
| æ„å»ºåº”ç”¨ | 5-10åˆ†é’Ÿ | |
| å¯åŠ¨æœåŠ¡ | 1-2åˆ†é’Ÿ | |
| **æ€»è®¡** | **20-40åˆ†é’Ÿ** | |

### B. ç£ç›˜ç©ºé—´éœ€æ±‚

- é•œåƒtaræ–‡ä»¶: ~230MB
- åŠ è½½åé•œåƒ: ~230MB
- æ„å»ºç¼“å­˜: ~500MB
- åº”ç”¨é•œåƒ: ~1.5GB
- æ•°æ®åº“æ•°æ®: ~100MB (åˆå§‹)
- **å»ºè®®é¢„ç•™**: 10GB

### C. ç½‘ç»œç«¯å£

| ç«¯å£ | æœåŠ¡ | è®¿é—® |
|------|------|------|
| 80 | å‰ç«¯ | å¯¹å¤–å¼€æ”¾ |
| 8000 | åç«¯API | å¯é€‰å¼€æ”¾ |
| 5432 | PostgreSQL | ä»…å†…éƒ¨ |
| 6379 | Redis | ä»…å†…éƒ¨ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-10-28
**ç»´æŠ¤è€…**: liangzh77
