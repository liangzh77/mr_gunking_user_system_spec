## ğŸš€ ç”Ÿäº§æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

### 1. æ‹‰å–æœ€æ–°ä»£ç 

```shell
cd /opt/mr_gunking_user_system_spec
git pull origin 001-mr
````

### 2\. é‡æ–°æ„å»ºå¹¶å¯åŠ¨åç«¯å®¹å™¨

```shell
# åœæ­¢å½“å‰åç«¯å®¹å™¨
docker-compose stop backend

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨ï¼ˆè¿™ä¼šåŒ…å«æˆ‘ä»¬çš„ä¿®å¤ï¼‰
docker-compose up -d --build backend

# ç­‰å¾…å®¹å™¨å¯åŠ¨å®Œæˆ
docker-compose logs -f backend
```

### 3\. ä¿®å¤æ•°æ®åº“çº¦æŸï¼ˆå…³é”®æ­¥éª¤ï¼‰

```shell
# è¿æ¥åˆ°PostgreSQLå®¹å™¨
docker exec -it mr_game_ops_backend_prod psql -U mr_admin -d mr_game_ops -c "
-- ä¿®æ”¹admin_accountsè¡¨çš„è§’è‰²çº¦æŸï¼Œå…è®¸financeè§’è‰²
ALTER TABLE admin_accounts DROP CONSTRAINT IF EXISTS chk_admin_role;

-- æ·»åŠ æ–°çš„æ£€æŸ¥çº¦æŸï¼ŒåŒ…å«financeè§’è‰²
ALTER TABLE admin_accounts
ADD CONSTRAINT chk_admin_role
CHECK (role IN ('super_admin', 'admin', 'operator', 'finance'));
"
```

### 4\. éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨

```shell
docker exec mr_game_ops_backend_prod python -c "
import asyncio, asyncpg
async def check():
    conn = await asyncpg.connect('postgresql://mr_admin:CHANGE_THIS_PASSWORD@postgres:5432/mr_game_ops')
    user = await conn.fetchrow('SELECT username, role, is_active FROM admin_accounts WHERE username = \$1', 'finance001')
    if user:
        print(f'ç”¨æˆ·å­˜åœ¨: {user[\"username\"]}, è§’è‰²: {user[\"role\"]}, æ¿€æ´»: {user[\"is_active\"]}')
    else:
        print('ç”¨æˆ·ä¸å­˜åœ¨')
    await conn.close()
asyncio.run(check())
"
```

### 5\. å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œé‡æ–°åˆ›å»º

```shell
docker exec mr_game_ops_backend_prod python /app/scripts/manage_finance_user.py create finance001 Pass@2024! å¼ å‘è´¢
```

### 6\. æµ‹è¯•è´¢åŠ¡ç™»å½•API

```shell
# æµ‹è¯•ç™»å½•
curl -X POST "http://localhost:8000/api/v1/auth/finance/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "finance001", "password": "Pass@2024!"}'
```

### 7\. å¦‚æœéœ€è¦ï¼Œé‡å¯æ•´ä¸ªæœåŠ¡

```shell
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose down
docker-compose up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
docker-compose logs -f
```

-----

## ğŸ” æ•…éšœæ’æŸ¥

å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

### æ£€æŸ¥å®¹å™¨çŠ¶æ€

```shell
docker-compose ps
docker-compose logs backend
```

### æ£€æŸ¥æ•°æ®åº“è¿æ¥

```shell
docker exec mr_game_ops_backend_prod python -c "
import asyncio, asyncpg
async def test():
    try:
        conn = await asyncpg.connect('postgresql://mr_admin:CHANGE_THIS_PASSWORD@postgres:5432/mr_game_ops')
        print('æ•°æ®åº“è¿æ¥æˆåŠŸ')
        await conn.close()
    except Exception as e:
        print(f'æ•°æ®åº“è¿æ¥å¤±è´¥: {e}')
asyncio.run(test())
"
```

### æ£€æŸ¥APIæœåŠ¡

```shell
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥APIæ–‡æ¡£
curl http://localhost:8000/docs
```

-----

## ğŸ¯ é¢„æœŸç»“æœ

æˆåŠŸéƒ¨ç½²åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

1.  **æˆåŠŸç™»å½•**ï¼šä½¿ç”¨ `finance001` / `Pass@2024!` ç™»å½•è´¢åŠ¡ç³»ç»Ÿ
2.  **è·å¾—Token**ï¼šæ”¶åˆ°åŒ…å«JWT Tokençš„å“åº”
3.  **è®¿é—®è´¢åŠ¡é¡µé¢**ï¼šåœ¨å‰ç«¯é¡µé¢æ­£å¸¸ç™»å½•

-----

## ğŸ’¡ é‡è¦æç¤º

1.  **ç¡®ä¿æ•°æ®åº“çº¦æŸå·²ä¿®å¤**ï¼šè¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥
2.  **éªŒè¯ç”¨æˆ·å­˜åœ¨**ï¼šå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œéœ€è¦é‡æ–°åˆ›å»º
3.  **æ£€æŸ¥å®¹å™¨é‡å¯**ï¼šç¡®ä¿æ–°çš„ä»£ç å·²ç»ç”Ÿæ•ˆ
